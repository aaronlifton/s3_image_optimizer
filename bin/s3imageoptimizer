#!/usr/bin/env ruby
# encoding: utf-8

require 's3_image_optimizer'

mode = ARGV.first
bucket = ARGV[1]
path = ARGV[2]

options = {
  bucket: (bucket || ENV['AWS_BUCKET']), dir: ENV['AWS_BUCKET_DIR'],
  upload_bucket: ENV['AWS_UPLOAD_BUCKET'],
  tmp: path
}

case mode
when "optimize_daemon"
  system "nohup s3imageoptimizer optimize &"
when "optimize"
  S3ImageOptimizer.optimize_bucket!(options)
when "upload"
  S3ImageOptimizer.upload_all!(options)
when "upload_daemon"
  system "nohup s3imageoptimizer upload #{bucket} #{path} &"
when "optimize_dir"
  S3ImageOptimizer.optimize_dir!((bucket || Dir.pwd))
else
  puts %{Command required!
    s3imageoptimizer [command] [bucket] [path]\n
    Commands
    [optimize_daemon] - run in background
    [optimize]        - run in foreground
    [upload]          - upload downloaded/optimized images
    [upload_daemon]   - upload in background
    [optimize_dir]    - optimize images in current or specified directory
    [help]            - show this message\n
    Arguments
    [bucket]          - optional bucket name
    [path]            - tmp path\n
    Happy optimizing! ¯\\_(ツ)_/¯
  }
end